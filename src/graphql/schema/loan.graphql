type LoanRequest {
  id: ID!
  borrower: User!
  amount: Float!
  purpose: String!
  durationMonths: Int!
  creditScore: Int
  securityType: SecurityType!
  collateral: Collateral
  description: String
  location: Location
  status: LoanStatus!
  interestedLenders: [LenderInterest]
  selectedLender: User
  agreement: LoanAgreement
  linkedLoan: Loan
  createdAt: String!
  updatedAt: String!
}

enum SecurityType {
  SECURED
  UNSECURED
}

enum LoanStatus {
  PENDING
  APPROVED
  REJECTED
  FUNDED
  CANCELLED
  LOAN_RECEIVED_PENDING
}

type Collateral {
  type: CollateralType
  estimatedValue: Float
  documents: [CollateralDocument]
}

enum CollateralType {
  REAL_ESTATE
  GOLD
  AUTOMOBILE
  STOCKS
  OTHER
}

type CollateralDocument {
  type: String!
  url: String!
  name: String
  uploadedAt: String!
}

type LenderInterest {
  lender: User!
  interestRate: Float!
  message: String
  timestamp: String!
}

type LoanAgreement {
  interestRate: Float!
  startDate: String!
  endDate: String!
  termsAccepted: Boolean!
}

type Loan {
  id: ID!
  loanRequest: LoanRequest!
  borrower: User!
  lender: User!
  amount: Float!
  interestRate: Float!
  durationMonths: Int!
  status: LoanActiveStatus!
  disbursementDate: String
  confirmedDate: String
  dueDate: String!
  repayments: [Repayment!]!
  totalRepaid: Float!
  remainingAmount: Float!
  borrowerConfirmed: Boolean!
  lenderConfirmed: Boolean!
  selectedLenderByBorrower: User
  isOverdue: Boolean!
  createdAt: String!
  updatedAt: String!
}

enum LoanActiveStatus {
  LOAN_RECEIVED_PENDING
  ACTIVE
  COMPLETED
  DEFAULTED
}

type Repayment {
  id: ID!
  amount: Float!
  paidDate: String!
  note: String
}

type LoanMetrics {
  totalBorrowed: Float!
  totalLended: Float!
  activeBorrowedCount: Int!
  activeLendedCount: Int!
  completedBorrowedCount: Int!
  completedLendedCount: Int!
  totalToRepay: Float!
  overdueLoans: Int!
}

type DeleteLoanRequestResponse {
  success: Boolean!
  message: String!
}

input RepaymentInput {
  loanId: ID!
  amount: Float!
  note: String
}

input LoanRequestInput {
  amount: Float!
  purpose: String!
  durationMonths: Int!
  creditScore: Int
  securityType: SecurityType!
  collateralType: CollateralType
  collateralValue: Float
  description: String
  location: LocationInput
}

input CollateralDocumentInput {
  loanRequestId: ID!
  type: String!
  url: String!
  name: String
}

extend type Query {
  getLoanRequests(status: LoanStatus, page: Int, limit: Int): [LoanRequest!]!
  getLoanRequest(id: ID!): LoanRequest
  getMyLoanRequests: [LoanRequest!]!
  getAvailableLoanRequests: [LoanRequest!]!
  getMyLoans(type: String!, status: LoanActiveStatus): [Loan!]!
  getLoanMetrics: LoanMetrics!
  getActiveLoan: Loan
  getLoanHistory(type: String!, page: Int, limit: Int): [Loan!]!
  getLoan(id: ID!): Loan
}

extend type Mutation {
  createLoanRequest(input: LoanRequestInput!): LoanRequest!
  updateLoanStatus(id: ID!, status: LoanStatus!): LoanRequest!
  addCollateralDocument(input: CollateralDocumentInput!): LoanRequest!
  expressInterest(loanRequestId: ID!, interestRate: Float!, message: String): LoanRequest!
  selectLender(loanRequestId: ID!, lenderId: ID!): LoanRequest!
  acceptLoanTerms(loanRequestId: ID!): LoanRequest!
  markLoanAsReceived(loanRequestId: ID!, lenderId: ID!): LoanRequest!
  confirmLoanDisbursement(loanId: ID!): Loan!
  recordRepayment(input: RepaymentInput!): Loan!
  markLoanAsCompleted(loanId: ID!): Loan!
  editLoanReceived(loanRequestId: ID!, lenderId: ID!): LoanRequest!
  deleteLoanRequest(loanRequestId: ID!): DeleteLoanRequestResponse!
}

extend type Subscription {
  newLoanRequest: LoanRequest
  loanRequestUpdated(id: ID!): LoanRequest
  loanInterestReceived(borrowerId: ID!): LoanRequest
}